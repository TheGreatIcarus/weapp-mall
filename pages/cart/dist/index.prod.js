"use strict";var _asyncWx=require("../../utils/asyncWx.js"),_runtime=_interopRequireDefault(require("../../lib/runtime/runtime"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Page({handleChooseAddress:function(){var t,n;return _runtime.default.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_runtime.default.awrap((0,_asyncWx.getSetting)());case 3:if(t=e.sent,!1===t.authSetting["scope.address"])return e.next=8,_runtime.default.awrap((0,_asyncWx.openSetting)());e.next=8;break;case 8:return e.next=10,_runtime.default.awrap((0,_asyncWx.chooseAddress)());case 10:(n=e.sent).all=n.provinceName+n.cityName+n.countyName+n.detailInfo,wx.setStorageSync("address",n),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}},null,null,[[0,15]])},handleItemChange:function(e){var t=e.currentTarget.dataset.id,n=this.data.cart,a=n.findIndex(function(e){return e.goods_id===t});n[a].checked=!n[a].checked,this.setCart(n)},setCart:function(e){var t=!0,n=0,a=0;e.forEach(function(e){e.checked?(n+=e.num*e.goods_price,a+=e.num):t=!1}),t=0!=e.length&&t,this.setData({cart:e,totalPrice:n,totalNum:a,allChecked:t}),wx.setStorageSync("cart",e)},handleItemAllCheck:function(){var e=this.data,t=e.cart,n=e.allChecked;n=!n,t.forEach(function(e){return e.checked=n}),this.setCart(t)},handleItemNumEdit:function(t){var n,a,r,s,c;return _runtime.default.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.currentTarget.dataset,a=n.operation,r=n.id,s=this.data.cart,c=s.findIndex(function(e){return e.goods_id===r}),1===s[c].num&&-1===a)return e.next=6,_runtime.default.awrap((0,_asyncWx.showModal)({content:"您是否要删除？"}));e.next=10;break;case 6:e.sent.confirm&&(s.splice(c,1),this.setCart(s)),e.next=12;break;case 10:s[c].num+=a,this.setCart(s);case 12:case"end":return e.stop()}},null,this)},handlePay:function(){var t,n,a;return _runtime.default.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.data,n=t.address,a=t.totalNum,n.userName){e.next=5;break}return e.next=4,_runtime.default.awrap((0,_asyncWx.showToast)({title:"您还没选择收获地址"}));case 4:return e.abrupt("return");case 5:if(0===a)return e.next=8,_runtime.default.awrap((0,_asyncWx.showToast)({title:"您还没有选购商品"}));e.next=9;break;case 8:return e.abrupt("return");case 9:wx.navigateTo({url:"/pages/pay/index",success:function(){},fail:function(){},complete:function(){}});case 10:case"end":return e.stop()}},null,this)},data:{data:{address:{},cart:[],allChecked:!1,totalPrice:0,totalNum:0}},onLoad:function(){},onReady:function(){},onShow:function(){var e=wx.getStorageSync("address"),t=wx.getStorageSync("cart")||[];this.setData({address:e}),this.setCart(t)},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});